<!DOCTYPE html>

<html lang="en" itemscope itemtype="https://schema.org/BlogPosting">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width">


  

<title>ラズパイを買って自宅サーバ入門した話</title>

  <meta name="description" content="背景 年末年始で暇だったので、ラズパイを買ってファイルサーバでも作ってみるか、と思って作り始めた。諸々で 2 日ほどかかった。
https://amzn.to/3vvqlhK">


<meta name="generator" content="Hugo 0.143.1">

  <meta name="author" content="velengel">
  
    <link rel="author" href="https://github.com/velengel">
  

<link rel="canonical" href="https://www.velengel.com/blog/posts/2024/0104/">


  
    <link rel="sitemap" type="application/xml" href="/blog/sitemap.xml">
  


    
    
    












<link rel="stylesheet" href="/blog/bundle.min.87c750e580f88b9cd2425b03b0fe7f8c26055dbf67c8c1d244475fa34dbcd068.css">

    <link rel="icon" href="/blog/icon.png">

    
  <meta property="og:type" content="article">

<meta property="og:site_name" content="Vel Labs(ベル研究所)">

  <meta property="og:title" content="ラズパイを買って自宅サーバ入門した話">


  <meta property="og:description" content="背景 年末年始で暇だったので、ラズパイを買ってファイルサーバでも作ってみるか、と思って作り始めた。諸々で 2 日ほどかかった。
https://amzn.to/3vvqlhK">

<meta property="og:url" content="https://www.velengel.com/blog/posts/2024/0104/">


    
  <meta itemprop="name" content="ラズパイを買って自宅サーバ入門した話">


  <meta itemprop="description" content="背景 年末年始で暇だったので、ラズパイを買ってファイルサーバでも作ってみるか、と思って作り始めた。諸々で 2 日ほどかかった。
https://amzn.to/3vvqlhK">



  
  
    <meta itemprop="datePublished" content="2024-01-04T09:53:32+09:00">
  
  
    
      <meta itemprop="dateModified" content="2024-01-04T09:53:32+09:00">
    
  


<link itemprop="url" href="https://www.velengel.com/blog/posts/2024/0104/">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css" integrity="sha384-wcIxkf4k558AjM3Yz3BBFQUbk/zgIYC2R0QpeeYb+TwlBVMrlgLqwRjRtGZiK7ww" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.js" integrity="sha384-hIoBPJpTUs74ddyc4bFZSM1TVlQDA60VBbJS0oA934VSz82sBx1X7kSx2ATBDIyd" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
<script>
  document.addEventListener("DOMContentLoaded", function() {
    renderMathInElement(document.body, {
      delimiters: [
        {left: "$$", right: "$$", display: true},
        {left: "$", right: "$", display: false},
        {left: "\\(", right: "\\)", display: false},
        {left: "\\[", right: "\\]", display: true}
      ],
      throwOnError: false
    });
  });
</script>

    
  


    
  </head>
  <body>
    <div id="container">
      <header id="top">
  <div id="header-grid">
    
      <div id="site-title">
        <a href="/blog/">Vel Labs(ベル研究所)</a>
      </div>
    
    
      
        <p id="description">エンジニアリングマネージャー見習いの個人開発備忘録</p>
      
    
  </div>
</header>

      <div id="middle">
        <div id="content" class="column">
          
          
            <nav id="breadcrumb" class="pane">
              


  
  
  <ol class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList">
    
      
  
  
    
      
  
  
    
    
    
      <li><a href="/blog/">Vel Labs(ベル研究所)</a></li>
    
  

      
    
    
    
      <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a href="/blog/posts/" itemprop="item"><span itemprop="name">Posts</span></a>
        <meta itemprop="position" content="1">
      </li>
    
  

      
    
    
    <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem" class="page">
      <a aria-current="location"><span itemprop="name">ラズパイを買って自宅サーバ入門した話</span></a>
      <meta itemprop="position" content="2">
    </li>
  </ol>


            </nav>
          
          
          <main class="pane">
            
  



<article class="single">
  <header>
    <h1 class="title" itemprop="headline">ラズパイを買って自宅サーバ入門した話</h1>
    
      <div class="time">
        
          <div><time datetime="2024-01-04"> 2024/01/04</time></div>
        
      </div>
    
  </header>
  <div class="body">
    
      <h2 id="背景">背景</h2>
<p>年末年始で<strong>暇</strong>だったので、ラズパイを買ってファイルサーバでも作ってみるか、と思って作り始めた。諸々で 2 日ほどかかった。<br>
<a href="https://amzn.to/3vvqlhK">https://amzn.to/3vvqlhK</a></p>
<p>ちょうどたまたま家に使わなくなった以下のものがあったので、それを有効活用したいみたいな気持ちもあった。</p>
<ul>
<li>200GB の microSD
<ul>
<li>元 switch の SD カード</li>
<li>ゲームが入らなくなってきたので 512GB を買ったのでこれが退役した</li>
</ul>
</li>
<li>2TB の HDD(Gdrive)
<ul>
<li><a href="https://amzn.to/3NVXlGn">https://amzn.to/3NVXlGn</a></li>
<li>元々は前の前の mac のバックアップ用途で買った</li>
<li>SSD が 256GB だったのでバックアップから復活させると簡単に容量を食い潰してしまうため、結局使わなかった</li>
</ul>
</li>
</ul>
<p>あとは icloud の容量が 200GB を超えそうだったので、自宅にバックアップ取れるならこれ以上プランを上げなくてもいいかな、みたいな気持ちがあった。</p>
<h2 id="やったこと">やったこと</h2>
<h3 id="osのインストール">OSのインストール</h3>
<p>普通の Recommended のやつを入れたら OMV6 が入らない(対応してない)と言われ、OMV6 を入れたら ssh ができなくなる、みたいな罠を踏んで 4 回くらい入れ直した。結局入れたのは Lite の方。</p>
<p>Debian12 系に当たるので巷の記事が微妙に古くて参考にならないものばかりだった。流れだけ参考にして公式ドキュメントを見るという王道に戻って解決。</p>
<h3 id="omv6のインストール回避">OMV6のインストール(回避)</h3>
<p>参考にしたもの: <a href="https://koh-sen.jp/blog/archives/12238">https://koh-sen.jp/blog/archives/12238</a><br>
OMV6 を入れるところまではなんとか行ったものの、なんか動作が不安定で先に進めなくなったので回避。<br>
別に<strong>ファイルサーバが作れればいい</strong>ので OMV6 にこだわる必要はなかった。</p>
<h3 id="nextcloudのインストール">NextCloudのインストール</h3>
<p>参考にしたもの: <a href="https://qiita.com/hiro2do/items/f8eed40acab713f20693">https://qiita.com/hiro2do/items/f8eed40acab713f20693</a><br>
色々apt 経由で入れられないか試行錯誤している中で、調査してたら見つけた。snap という便利パッケージ管理ツール的なのが出ていて、それを使ったら一瞬で入った。すごい。<br>
公式: <a href="https://snapcraft.io/docs">https://snapcraft.io/docs</a></p>
<h3 id="外付けhdd有効化">外付けHDD有効化</h3>
<p>↑のブログ参考に、mount 系のコマンドは別で調べてやったら入った。素晴らしいね。<br>
<code>df -h</code> で自分の意図したものが出てきた時は軽く感動。普段仕事ではクラウド上の EC2 とかしか触ってないから。物理サーバは実感が湧くのでいいね。</p>
<h3 id="外部公開とhttpstodo">外部公開とHTTPS(TODO)</h3>
<p>↑のブログに言われるまま tailscale とか色々入れてたら、どうも証明書関連でうまく行ってないっぽく全世界に公開しそう(一瞬した)なった。一旦内部公開で止めることにした。別にそれでも<strong>要件は満たせる</strong>ので。</p>
<h3 id="nextcloudを写真のバックアップ先に設定">NextCloudを写真のバックアップ先に設定</h3>
<p>参考にしたもの: <a href="https://denor.jp/iphone%E3%81%A7%E6%92%AE%E5%BD%B1%E3%81%97%E3%81%9F%E5%86%99%E7%9C%9F%E3%82%84%E5%8B%95%E7%94%BB%E3%82%92nextcloud%E3%82%B5%E3%83%BC%E3%83%90%E3%81%B8%E8%87%AA%E5%8B%95%E3%82%A2%E3%83%83%E3%83%97">https://denor.jp/iphone%E3%81%A7%E6%92%AE%E5%BD%B1%E3%81%97%E3%81%9F%E5%86%99%E7%9C%9F%E3%82%84%E5%8B%95%E7%94%BB%E3%82%92nextcloud%E3%82%B5%E3%83%BC%E3%83%90%E3%81%B8%E8%87%AA%E5%8B%95%E3%82%A2%E3%83%83%E3%83%97</a><br>
やるだけ。</p>
<p>ここまで 1 日目。この後監視入れて wiki サーバでも建ててみるかという気分になり、引き続きインストールをしていた。</p>
<h3 id="mackerel導入">mackerel導入</h3>
<p>入れるのはやるだけ。カスタムメトリックのプラグインを導入するのが苦労した。やりたかったのはラズパイの CPU 温度の監視。<br>
公式: <a href="https://mackerel.io/ja/docs/entry/advanced/custom-metrics">https://mackerel.io/ja/docs/entry/advanced/custom-metrics</a><br>
最終的に書いたもの</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>plugin.metrics.temp<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>command <span style="color:#f92672">=</span> <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;bash&#34;</span>, <span style="color:#e6db74">&#34;/home/xxx/temp.sh&#34;</span><span style="color:#f92672">]</span>
</span></span></code></pre></div><p>最初は <code>command=&quot;/home/xxx/temp.sh&quot;</code> と書いていた。これでも動いていてくれて良くない？と思ったがなぜかメトリクスが送られなかったので書き方を変えた。</p>
<p>ちゃんと discord にも通知するようにした✌️

  <img src="images/mackerel.jpeg" alt="notify">

</p>
<h3 id="mediawiki導入回避">mediawiki導入(回避)</h3>
<p>公式: <a href="https://www.mediawiki.org/wiki/Manual:Running_MediaWiki_on_Debian_or_Ubuntu/ja">https://www.mediawiki.org/wiki/Manual:Running_MediaWiki_on_Debian_or_Ubuntu/ja</a></p>
<p>これに沿って初回のセットアップページまでは進んだ。(そこにいくまでに apache2 に mod-php を入れてなくてただの php ファイルがそのまま表示されるみたいな罠を踏んだ。1 回休み。)<br>
ただ、NextCloud が MySQL を立ち上げてるっぽく<strong>競合してしまった</strong>ので、仕方なく諦めた。DB を共存させたりポート変えたりとかの回避手段はあるものの、そこまでしたいわけでもないので諦めた。(try はした)</p>
<h3 id="dokuwiki導入">dokuwiki導入</h3>
<p>なんと dokuwiki は DB を立ち上げる必要がないので、いけそう！と思って入れた。<br>
公式: <a href="https://www.dokuwiki.org/install:debian">https://www.dokuwiki.org/install:debian</a></p>
<p>なんとか入ってくれたのでよかった。ただ普通に記法に慣れない w<br>
最近のドキュメント書くツールは便利なんだなあというのを改めて感じる。</p>
<h3 id="メールを送るtodo">メールを送る(TODO)</h3>
<p>dokouwiki のユーザー登録にメール送信が必要なのだが、いつまで経ってもメールが来なかった。ログを見ると sendmail が入ってないよって言われたから入れてみるも挙動変わらず。 <br>
どうやらメールサーバの設定とか Gmail のアプリパスワード？的な色々準備が必要そうなので、宿題。</p>
<h3 id="viのモードを治す">viのモードを治す</h3>
<p>参考にしたもの: <a href="https://yaru-yaru.net/reizo/raspberrypi%E3%81%AEvi%E3%81%A7%E6%96%B9%E5%90%91%E3%82%AD%E3%83%BC%E3%82%92%E6%8A%BC%E3%81%99%E3%81%A8abcd%E3%81%8C%E5%87%BA%E3%82%8B%E5%95%8F%E9%A1%8C/">https://yaru-yaru.net/reizo/raspberrypi%E3%81%AEvi%E3%81%A7%E6%96%B9%E5%90%91%E3%82%AD%E3%83%BC%E3%82%92%E6%8A%BC%E3%81%99%E3%81%A8abcd%E3%81%8C%E5%87%BA%E3%82%8B%E5%95%8F%E9%A1%8C/</a><br>
vi 互換モードというのになっていたらしい。
最初ユーザーのホームディレクトリにのみ <code>.vimrc</code> 書いてたら、<code>sudo vi</code> した時に現象が解決しなくて焦った。仕方なく root の方にも書いてあげたら治った。こういう細かい課題を解決できるようになったのは進歩を感じるね。</p>
<h3 id="構成図を書いた">構成図を書いた</h3>
<p>ちゃんと覚えてるうちにポートとかパスをメモっておいた。</p>
<h2 id="幸運だったこと">幸運だったこと</h2>
<h3 id="一人暮らしを始めていた">一人暮らしを始めていた</h3>
<p>これによりルーターの全権を握れているのが大きい。また、契約時にメールサーバももらっていたのでその辺の検証もしやすい。自分の城があるって大事だよね。</p>
<h3 id="仕事で触ってた">仕事で触ってた</h3>
<p>困ったら公式ドキュメントを見る。落ち着いてエラーログを確認する。みたいな一連の所作は仕事で息をするように身につけていた(そうしないと仕事にならない)ので、万策尽きた！みたいになることが少なくてよかった。</p>
<p>大学の時の数年前の自分は調べる力が弱かったのでこういう時に解決できず諦めるしかなかった。</p>
<h2 id="反省">反省</h2>
<h3 id="調査ログを途中から取り始めた">調査ログを途中から取り始めた</h3>
<p>最初はまあすぐ終わるやろ、と思いながらやっていた。trello のコメントにフロー情報的に残していた。</p>
<p>そうだとしても調査ログは残すべきだった。コマンドとやったことを書いておくだけで後から見直した時に価値が出る。結局 notion にストック情報としてまとめなおした。</p>
<h2 id="todo">TODO</h2>
<p>個人開発にすぎないので気が向いたらやること一覧</p>
<ul>
<li>外部公開と HTTPS</li>
<li>メールを送る</li>
<li>温度、湿度、二酸化炭素濃度などのモニタリング</li>
</ul>
    
  </div>
  <footer>
    
    
    
      
    
    
    
    
    
      
    
      
        
      
    
      
        
      
    
      
    
    
    
    
      
      
      
        
        
      
      
        <div class="author" itemprop="author" itemscope itemtype="https://schema.org/Person">
          
            <a rel="author" href="https://github.com/velengel" itemprop="url"><span itemprop="name">velengel</span></a>
          
        </div>
      
    
  </footer>
</article>


          </main>
          
          
  
    
    
    
      <nav class="prev-next">
        
          <a class="next" href="/blog/posts/2024/0525/" title="次の記事: ゼロからのOS自作入門を読み終わった話">ゼロからのOS自作入門を読み終わった話</a>
        
        
          <a class="prev" href="/blog/posts/2023/1211/" title="前の記事: 読書メモのフォーマット所感">読書メモのフォーマット所感</a>
        
      </nav>
    
  

          
            



  


  <nav class="pane">
    <header class="component-title">次に読む</header>
    <ul class="dense">
      
        <li><a href="/blog/posts/2024/0525/">ゼロからのOS自作入門を読み終わった話</a></li>
      
        <li><a href="/blog/posts/2023/1015/">表示の都合でデータを別で作ってはいけない</a></li>
      
    </ul>
  </nav>


          
          
        </div>
        <aside id="sidebar" class="column">
  <div class="pane sidebar-top">
  <div class="profile">
    <a href="/blog/pages/bio">
      <img class="avatar" src="/blog/bio.png">
    </a>
    <div class="name">
      <a href="/blog/pages/bio">velengel</a>
    </div>
  </div>
  <p>技術とマネジメントの二刀流⚔</p>
</div>

  
<nav class="pane">
  <ul>
    
      <li>
        <a href="/blog/">Vel Labs(ベル研究所)</a>
      </li>
    
    
      <li>
        <a href="/blog/pages/bio/">自己紹介</a>
      </li>
    
    
      <li>
        <a href="/blog/archives/">Archives</a>
      </li>
    
    
      <li>
        <a href="/blog/search/">Search</a>
      </li>
    
    
      <li>
        <a href="/blog/index.xml">RSS</a>
      </li>
    
  </ul>
</nav>

  

  
    
      <nav class="pane">
        <form class="sidebar-search-form" method="get" action="/blog/search/">
          <input required type="search" name="q" id="query" aria-label="検索クエリ">
          <input type="submit" value="検索">
        </form>
      </nav>
    
  


  


  
    <nav class="pane">
      
  
    <ul class="folders">
      
        
        <li class="folder">
          <a href="/blog/pages/">
            Pages (1) 
          </a>
          
  

        </li>
      
        
        <li class="folder">
          <a href="/blog/posts/">
            Posts (10) 
          </a>
          
  

        </li>
      
    </ul>
  

    </nav>
  


  



  
    
    
    
    
    
    
      <nav class="pane">
        <header class="component-title">
          <a href="/blog/tags/">Tags</a>
        </header>
        <ul class="tags">
          
            <li class="tagged">
              <a href="/blog/tags/c/">C</a>
            </li>
          
            <li class="tagged">
              <a href="/blog/tags/loupedeck/">Loupedeck</a>
            </li>
          
            <li class="tagged">
              <a href="/blog/tags/memo/">Memo</a>
            </li>
          
            <li class="tagged">
              <a href="/blog/tags/php/">Php</a>
            </li>
          
            <li class="tagged">
              <a href="/blog/tags/programming/">Programming</a>
            </li>
          
            <li class="tagged">
              <a href="/blog/tags/uri%E3%82%B9%E3%82%AD%E3%83%BC%E3%83%A0/">URIスキーム</a>
            </li>
          
            <li class="tagged">
              <a href="/blog/tags/vue/">Vue</a>
            </li>
          
            <li class="tagged">
              <a href="/blog/tags/windows/">Windows</a>
            </li>
          
        </ul>
        
      </nav>
    
  


  
  

  
    
      <nav class="pane">
        
          <header class="component-title">
            <a href="/blog/categories/">Categories</a>
          </header>
          <ul>
            
              <li>
                <a href="/blog/categories/tech/">Tech</a>
              </li>
            
          </ul>
        
      </nav>
    
  

  
    
  

  


  
  

  <nav class="pane">
    <header class="component-title">最新記事</header>
    <ul class="dense">
      
        <li>
          <a href="/blog/posts/2025/0105/">texteditor途中まで作った</a>
        </li>
      
        <li>
          <a href="/blog/posts/2024/0713/">windowsの自動起動(スタートアップ)アプリに標準のクロックを入れたい</a>
        </li>
      
        <li>
          <a href="/blog/posts/2024/0525/">ゼロからのOS自作入門を読み終わった話</a>
        </li>
      
        <li>
          <a href="/blog/posts/2024/0104/">ラズパイを買って自宅サーバ入門した話</a>
        </li>
      
        <li>
          <a href="/blog/posts/2023/1211/">読書メモのフォーマット所感</a>
        </li>
      
        <li>
          <a href="/blog/posts/2023/1015/">表示の都合でデータを別で作ってはいけない</a>
        </li>
      
        <li>
          <a href="/blog/posts/2023/0725/">loupedeckとWindowsのURIスキーム</a>
        </li>
      
        <li>
          <a href="/blog/posts/2023/0719/">phpで掲示板作る</a>
        </li>
      
        <li>
          <a href="/blog/posts/2023/0717/">ブログ改修工事</a>
        </li>
      
        <li>
          <a href="/blog/posts/my-first-post/">はじまり</a>
        </li>
      
    </ul>
  </nav>


  
</aside>

      </div>
      <footer id="bottom">
  <small>
    <a href="/blog/">
      <span>Vel Labs(ベル研究所)</span>
    </a>
    <wbr>
    <span>
      
        
        
          ©&nbsp;2023–2025
        
        
          
            <a href="https://github.com/velengel"><em>velengel</em></a>
          
        
      
    </span>
    <br>
    <span>
      <a href="https://github.com/curegit/nagoya"><i>Nagoya</i>&nbsp;Theme</a>&nbsp;by&nbsp;<a href="https://curegit.jp/"><i>curegit</i></a>.
      <wbr>
      Built&nbsp;with&nbsp;<a href="https://gohugo.io/">Hugo</a>.
    </span>
  </small>
</footer>

    </div>
  </body>
</html>
